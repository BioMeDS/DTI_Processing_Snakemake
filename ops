{"author":{"id":"4bcae43b5f5e9fa8cdb63fa93f2b5cd1c1dbb3d089fc0826ed1b8841dfe462fd"},"ops":[{"type":1,"timestamp":1755071318,"nonce":"ijMOjjVKcVE8y0gu1dGPdfct5CI=","title":"Fix eddy error with --nthr and gpu","message":"If eddy_cuda is available and the --nthr parameter is set to anything else than 1\neddy fails with the following error message:\n```\nEddyInputError:  The version compiled for GPU can only use 1 CPU thread (i.e. --nthr=1)\n```\n\nReport the problem (for our use case) to the fsl mailinglist.\nMaybe it can be downgraded to a Warning rather than an Error.\n\nIn the meantime we can work around this issue by borrowing the checking code from eddy\nto determine whether eddy_cuda is available:\n```python\n    fsldir    = os.environ['FSLDIR']\n    find_cuda = op.join(fsldir, 'bin', 'find_cuda_exe')\n    eddy_cuda = sp.check_output((find_cuda, 'eddy_cuda'), text=True).strip()\n    eddy_cpu  = op.join(fsldir, 'bin', 'eddy_cpu')\n\n    # Call eddy_cuda if it exists and we\n    # are running on a system with a GPU\n    if eddy_cuda != '':\n        cmd = eddy_cuda\n```","files":null}]}